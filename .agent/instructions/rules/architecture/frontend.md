# Architecture: Frontend

## Master SPA Architecture

**Goal**: Establish a standardized Single Page Application (SPA) master screen structure for all modern components generated by `moqui-ai`. This ensures Moqui applications correctly load the Vue/Quasar frontend without breaking the `XmlAction` rendering stack.

### 1. The Wrapper Screen (`[App]Wrapper.xml`)
This is the root entry point that intercepts the browser request, loads the necessary Vue/Quasar libraries, and hands off rendering to the client-side SPA.

#### Key Requirements:
- **Theme**: Must set `screen-theme-type-enum-id="STT_INTERNAL_QUASAR2"`.
- **Widgets Block**: *CRITICAL* â€” Do not put `<render-mode>` inside of `<pre-actions>`. Due to Freemarker constraints, `render-mode` must always be placed within `<widgets>`.
- **Boilerplate Injection**: Inject the centralized `moqui-ai` theme boilerplate that handles all auth checks and library loading inside of `<widgets>`:
  ```xml
    <widgets>
        <render-mode>
            <!-- Injects the standardized Vue/Quasar boilerplate scripts from moqui-ai -->
            <text type="html" location="component://moqui-ai/template/spa/Quasar2Wrapper.qvt2.ftl"/>
        </render-mode>
    </widgets>
  ```
- **Subscreens**: Must point to the Main SPA Screen (`[app].xml`) as the `default-item`.
- **Render Mode**: Must inject `component://webroot/screen/includes/WebrootVue.qvt2.ftl` inside `<widgets><render-mode><text type="html"...` to trigger the actual Vue application mount.

### 2. The Main SPA Screen (`[app].xml`)
This screen defines the persistent layout (Header, Drawer, Content) that wraps all other routes.

#### Key Requirements:
- **Namespace**: Use `xsi:noNamespaceSchemaLocation="component://moqui-ai/xsd/moqui-ai-screen.xsl"`.
- **Global Templates**: Inject `globals.qvt2.ftl` (if using session tokens/custom global config) via `<render-mode>`.
- **App Container**: 
  - Wrap the UI in `<container id="apps-root">`.
  - Use `<screen-layout view="hHh lpR fFf">`.
- **Header Structure**:
  - Implement `<screen-header>` and `<screen-toolbar>`.
  - Include the required App Title and Logo.
  - Include the `<subscreens-menu>` macro to automatically render the horizontal navigation tabs based on child screens.
- **Content Area**:
  - Implement `<screen-content>` wrapping exactly one `<subscreens-active/>` tag. (The `moqui-ai` content negotiation hook will ensure this renders the `<m-subscreens-active>` Vue router-view).

### 3. Sub-Screens (e.g., `Home.xml`)
These are injected into the `<subscreens-active/>` area.
- Keep them clean and purely focused on business logic and layout.
- Rely on standard form macros or custom tags, injecting custom Vue components via `script src` inside `<render-mode>` text blocks only when strictly necessary.
